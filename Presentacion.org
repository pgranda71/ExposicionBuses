#+options: H:2
#+latex_class: beamer
#+columns: %45ITEM %10BEAMER_env(Env) %10BEAMER_act(Act) %4BEAMER_col(Col) %8BEAMER_opt(Opt)
#+beamer_theme: default
#+beamer_color_theme:
#+beamer_font_theme:
#+beamer_inner_theme:
#+beamer_outer_theme:
#+beamer_header:

#+title: S8-Buses-del-Sistema
#+date: 2025-12-22
#+author: Paula Granda,
#+email: paula.granda@epn.edu.ec
#+language: es
#+select_tags: export
#+exclude_tags: noexport
#+creator: Emacs 27.1 (Org mode 9.3)
#+cite_export: biblatex

#+bibliography: ./FormatoTareas/bibliography.bib
#+LATEX_HEADER: \usepackage[T1]{fontenc}
#+LATEX_HEADER: \usepackage[utf8]{inputenc}
#+LATEX_HEADER: \usepackage[spanish]{babel}
#+LATEX_HEADER: \usepackage[backend=biber,citestyle=apa, style=apa]{biblatex}


* Indicaciones
** Indicaciones
:PROPERTIES:
:BEAMER_opt: allowframebreaks
:END:
- Recuerde que si options: H:2, entonces: 
  - ~*~ Declara el nombre de la Sección
  - ~**~ Declara el nombre de la diapositiva
- Puede alterar la estructura de la diapositiva si lo considera
  necesario
- Para este tema consulte las siguientes fuentes:
  - \textcite{stallings2006}, 7ma edición, 2006, Español, páginas 99 a
    119 [cite:@stallings2006].
  - \textcite{stallings2022computer}, 11ava edición, 2022, English,
    páginas 116 a 131 [cite:@stallings2022computer].
- La tupla (E1,7, 97) significa Grupo E1, Libro Edición 7, página 97
  del PDF (no del libro)


* Buses del Sistema (Sección)
** Estructuras de Interconexión (Nombre Diapositiva)(E1, 7, 97)
* Interconexión con Buses (Sección)
** Interconexión con Buses (E1, 7, 99)
** Estructura del Bus  (E1, 7, 99)
** Jerarquía de Buses Múltiples (E2, 7, 102)
*** Definición
[[file:Imagenes/Jerarquia.png]]
- La jerarquía de buses múltiples organiza los buses del sistema en distintos niveles.
- Cada nivel se diferencia por su velocidad, función y tipo de dispositivos conectados.
- Su objetivo es mejorar el rendimiento del sistema y evitar cuellos de botella.

*** Organización por niveles
[[file:Imagenes/OrganBuses.png]]
- Buses de alta velocidad: conectan la CPU con la memoria principal.
- Buses de velocidad media: permiten la conexión de tarjetas y dispositivos de expansión.
- Buses de baja velocidad: se usan para entrada y salida, como teclado, mouse y almacenamiento.
  
*** Importancia
[[file:Imagenes/ImporBus.png]]
- Optimiza el flujo de datos dentro del sistema.
- Evita que dispositivos lentos afecten a los más rápidos.
- Es utilizada en la mayoría de computadoras modernas.
** Elementos de Diseño de un Bus (E2, 7, 104)
* Interconexión punto a punto(E3, 11, 118)
** Interconexión punto a punto 
** QPI (E3, 11, 120)

** PCI 

- Bus popular de alto ancho de banda, independiente del procesador.
- Ofrece un mejor rendimiento del sistema para subsistemas de E/S de alta velocidad, por ejemplo : adaptadores gráficos, controladores de red y controladores de disco.
- PCI (Intel, 1990), Intel comenzó a trabajar en PCI en 1990 para sus sistemas basados en Pentium. Pronto liberó todas las patentes al dominio público y promovió la creación de una asociación industrial, el PCI Special Interest Group (SIG), para desarrollar y mantener la compatibilidad de las especificaciones PCI. Gracias a esto, PCI ha sido ampliamente adoptado y se utiliza cada vez más en computadoras personales, estaciones de trabajo y servidores. 
- Al estar en dominio público y contar con el apoyo de gran parte de la industria de microprocesadores y periféricos, los productos PCI fabricados por diferentes proveedores son compatibles.

** PCI express

-  PCIe, al igual que QPI, es un esquema de interconexión punto a punto destinado a reemplazar los buses tradicionales como PCI.
-  Un requisito clave de PCIe es la alta capacidad para soportar dispositivos de E/S de mayor velocidad, como Ethernet Gigabit.
-  PCIe incorpora mecanismos para manejar flujos de datos en tiempo real, lo cual resulta esencial en aplicaciones como video bajo demanda, distribución de audio, comunicaciones y sistemas embebidos.
-  PCIe puede gestionar múltiples transferencias simultáneas y priorizar aquellas que requieren atención inmediata, garantizando un rendimiento adecuado en entornos con altas exigencias de velocidad y baja latencia.

* Arquitectura Física y Lógica de PCIe

-  La arquitectura física y lógica de PCIe se organiza alrededor del root complex (chipset), que conecta procesador y memoria con los dispositivos PCIe.
-  Actúa como buffer para manejar diferencias de velocidad entre controladores de E/S y CPU/memoria, y traduce los formatos de transacción PCIe a las señales del procesador y la memoria. El chipset soporta múltiples puertos PCIe que pueden conectarse directamente a dispositivos, a switches que gestionan varios flujos, o a otros tipos de endpoints.

[[file:Imagenes/ConfPCIe.png]]

* Arquitectura Física y Lógica de PCIe

Al igual que QPI, PCIe se organiza en una arquitectura de protocolos en capas:

- *Capa física:* cables, señales y circuitería para transmitir bits.
- *Capa de enlace de datos:* asegura transmisión confiable y control de flujo (DLLPs).
- *Capa de transacción:* gestiona transferencias de datos y control de flujo mediante paquetes (TLPs).
- *Capas de software superiores:* generan solicitudes de lectura/escritura que viajan como paquetes hacia los dispositivos de E/S.

[[file:Imagenes/PCIeCapaFisica.png]]

* Capa física

- PCIe es una arquitectura punto a punto similar a QPI. Cada puerto PCIe está formado por lanes (carriles) bidireccionales, que transmiten datos mediante señalización diferencial sobre pares de cables. Un puerto puede tener 1, 4, 8, 16 o hasta 32 lanes.
- A diferencia de QPI, PCIe no usa la línea de reloj para sincronizar los bits, por lo que emplea dos técnicas:
    *Scrambling:* hace que los datos parezcan aleatorios, evitando largas secuencias de 1s o 0s y mejorando la sincronización.
    *Encoding 128b/130b:* añade un encabezado de 2 bits para distinguir bloques de datos y bloques de control.

[[file:Imagenes/PCIeCapaFisica2.png]]

* Proceso de transmisión

- *Scrambler:* aleatoriza los datos.
- *Encoder 128b/130b:* convierte 128 bits en 130 bits.
- *Conversión paralelo-serial:* envía los bits uno a uno por señal diferencial.
- *En el receptor:* sincronización de reloj, conversión serial-paralelo, decodificación y descrambling para recuperar los datos originales.
Gracias a estas técnicas, PCIe 3.0 alcanza velocidades de hasta 16 GB/s, y cada transmisión comienza y termina con una secuencia de 8 bits de enmarcado para facilitar la sincronización.

[[file:Imagenes/ProcesoDeTransmision.png]]

* Estructura de Paquetes en PCI Express

*Puntos Clave:* 
- PCle utiliza una arquitectura basada en capas.
- La comunicación se realiza mediante paquetes, no solo señales eléctricas.
- Los paquetes principales son TLP y DLLP.

* Ensamblaje de Paquetes de Transacción
El software de capa superior envia datos a la Capa de Transacción(TL).
*Campos del TLP:* 
- *Header:* Define el tipo de paquete y la información de enrutamiento.
- *Data:* Carga útil de hasta 4096 bytes.
- *ECRC:* Comprobación de errores opcional de extremo a extremo.

* Fiabilidad y Control en el Enlace (DLL)
Garantizar la entrega fiable de paquetes a través del enlace PCIe.
*Funciones principales:* 
- Añade un número de secuencia (16 bits) y un LCRC (32 bits) al TLP.
- Gestiona los DLLP (Data Link Layer Packets) para control del enlace.
*Tipos de DLLP:* 
- Paquetes de Control de Flujo (Flow Control).
- Gestión de Energía (Power Management).
- ACK/NAK (Confirmación de recepción o error).

* ¿Cómo viaja un paquete?
*En cada nodo intermedio (Switch):* 
- La capa de enlace (DLL) comprueba el LCRC y el número de secuencia.
- Si no hay errores: Pasa el paquete a la capa de transacción para ser enrutado.
- Si hay errores: Se pide retransmisión (NAK).
*En el destino:* 
- La capa de transacción procesa los datos y los entrega al software.

* Referencias
** Bibliografía
:PROPERTIES:
:BEAMER_opt: allowframebreaks
:END:

#+print_bibliography: 

